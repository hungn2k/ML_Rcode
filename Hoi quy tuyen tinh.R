# C??i ?????t v?? load th?? vi???n MASS, c?? ch???a b??? d??? li???u Boston c???n nghi??n c???u
# install.packages("MASS")
library("MASS")

# T???ng quan v??? b??? d??? li???u Boston: 
?Boston
str(Boston)

# L???nh pairs ????? v??? bi???u ????? ph??n t??n gi???a c??c bi???n
Boston_data = Boston
pairs(Boston_data)
pairs(~medv+lstat+age+rm, data= Boston_data)

#Ma tr???n t????ng quan gi???a c??c bi???n medv, lstat, age, rm
cor(Boston_data[,c("medv", "lstat","age","rm")])


# Th???c hi???n chia b??? d??? li???u th??nh 2 ph???n:2/3 so quan s??t ????? x??y d???ng m?? h??nh,
# 1/3 so quan s??t ????? ki???m ?????nh s??? d???ng library caTools
library("caTools")
Boston_data["ID"] = c(1:506)
set.seed(123)
split = sample.split(Boston_data$ID, SplitRatio = 2/3)

mauXayDung = subset(Boston_data, split==TRUE)
mauKiemDinh = subset(Boston_data, split==FALSE)

#####################
# X??y d???ng m?? h??nh 1: S??? d???ng c??c bi???n lstat(% d??n c?? c?? ?????a v??? th???p),age(tu???i
# nha trung binh), rm( s??? ph??ng trung b??nh) 
# ????? d??? b??o gi?? tr??? nh??
#####################

moHinh1 = lm(medv~ lstat+age+rm, data = mauXayDung)
moHinh1
summary(moHinh1)

# ?? ngh??a c???a B???ng s??? summary:
#  C???t Estimate: H??? s??? beta c???a m?? h??nh h???i quy

# C???t Std. Error: ????? l???ch chu???n c???a ?????c l?????ng h??? s??? beta t????ng ???ng

# C???t t-value = Estimate/Std.Error: L?? gi?? tr??? t trong ki???m ?????nh gi??? thuy???t
# v???i H0: beta = 0, H1: beta <> 0, n???u gi?? tr??? t c?? tr??? tuy???t ?????i
# l???n h??n gi?? tr??? t???i h???n, gi??? thuy???t H0 b??? b??c b???, th??? hi???n h??? s??? beta c?? ?? ngh??a th???ng k??

# C???t Pr(>|t|): Gi?? tr??? p-value trong ki???m ?????nh gi??? thuy???t H0: beta = 0, H1: beta <>0 

# D??? b??o gi?? tr??? c???a medv trong b??? m???u x??y d???ng, s??? d???ng h??m predict
duBao_xayDung = predict(moHinh1, mauXayDung)

# T???ng ph???n d?? b??nh ph????ng (RSS) c???a b??? m???u x??y d???ng
RSS_xayDung = sum((duBao_xayDung - mauXayDung$medv)^2)

# T???ng ph???n d?? b??nh ph????ng (RSS) c???a m?? h??nh c?? s???
TSS_xayDung = sum((mean(mauXayDung$medv) - mauXayDung$medv)^2)

# Gi?? tr??? R-square(R2) c???a m?? h??nh tr??n m???u x??y d???ng
R2_xayDung = 1 - (RSS_xayDung/TSS_xayDung)

# Th???c hi???n t????ng t??? ????? t??nh R2 cho m???u ki???m ?????nh, ch?? ?? l?? khi t??nh TSS cho m???u ki???m ?????nh
# s??? d???ng trung b??nh c???a bi???n medv cho m???u x??y d???ng (nh???m kh??ng s??? d???ng th??ng tin tr??n b??? m???u k??)

duBao_kiemDinh = predict(moHinh1, mauKiemDinh)
RSS_kiemDinh = sum((duBao_kiemDinh - mauKiemDinh$medv)^2)
TSS_kiemDinh = sum((mean(mauXayDung$medv) - mauKiemDinh$medv)^2)
R2_kiemDinh = 1 - (RSS_kiemDinh/TSS_kiemDinh)


#####################
# X??y d???ng m?? h??nh 2: S??? d???ng t???t c??? c??c bi???n trong qu?? tr??nh d??? b??o
#####################

moHinh2 = lm(medv~ ., data = mauXayDung)
moHinh2
summary(moHinh2)

# D??? b??o v?? t??nh R2 cho m???u x??y d???ng
duBao_xayDung = predict(moHinh2, mauXayDung)
RSS_xayDung = sum((duBao_xayDung - mauXayDung$medv)^2)
TSS_xayDung = sum((mean(mauXayDung$medv) - mauXayDung$medv)^2)
R2_xayDung = 1 - (RSS_xayDung/TSS_xayDung)

# D??? b??o v?? t??nh R2 cho m???u ki???m ?????nh
duBao_kiemDinh = predict(moHinh2, mauKiemDinh)
RSS_kiemDinh = sum((duBao_kiemDinh - mauKiemDinh$medv)^2)
TSS_kiemDinh = sum((mean(mauXayDung$medv) - mauKiemDinh$medv)^2)
R2_kiemDinh = 1 - (RSS_kiemDinh/TSS_kiemDinh)
